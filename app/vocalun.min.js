/*! vocalun 2014-07-10 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=function(a){this.store=function(b,c){a[b.key]=JSON.stringify({value:b.value,expireDate:Date.now()+c})},this.find=function(b){if(void 0===a[b])return null;var c=JSON.parse(a[b]);return Date.now()<c.expireDate&&null!==c?c.value:(delete a[b],null)}};b.exports=c},{}],2:[function(a,b){var c={VocaDB:new function(){this.PUBLIC_URL="http://vocadb.net/",this.API_BASE_URL=this.PUBLIC_URL+"api/",this.ALBUM_PAGE_URL=this.PUBLIC_URL+"Album/Details/"}};b.exports=c},{}],3:[function(a,b){var c=function(a){this.onChanged=function(b){var c=new MutationObserver(function(){b()});c.observe(a,{characterData:!0,subtree:!0})}};b.exports=c},{}],4:[function(a,b){var c=a("./vocalun_console"),d=function(a,b){this.ONE_HOUR=36e5,this.getSongApiUrl=function(b){return a.API_BASE_URL+"songs?pvService=NicoNicoDouga&pvId="+b+"&fields=Albums"},this.fetchAlbumInformation=function(a){var d=this.getSongApiUrl(a.id);c.log(d);var e=b.find(a.id);return null!==e?(c.log("Cache used."),void a.success(e)):void $.ajax({context:this,headers:{Accept:"text/json; charset=utf-8","Content-Type":"text/json; charset=utf-8"},url:d,cache:!0,jsonpCallback:"jsonp",jsonp:"callback",success:function(d,e,f){null!==d?(c.log("Cache stored."),b.store({key:a.id,value:d},this.ONE_HOUR),a.success(d,e,f)):a.error(f,e)},error:function(b,c,d){a.error(b,c,d)}})}};b.exports=d},{"./vocalun_console":6}],5:[function(a){var b=a("./config"),c=a("./vocalun_console"),d=a("./dom_observer"),e=a("./vocadb_fetcher"),f=a("./cache.js"),g=function(a){function b(b){var d=$("<ul></ul>");return b.forEach(function(b){c.log(b),d.append('<li><a target="_blank" href="'+a.ALBUM_PAGE_URL+b.id+'">"'+b.name+'"に収録</a></li>')}),d}this.init=function(){$(".videoDescription").after('<div id="vocalun_album_information"></div>')},this.render=function(a){var c=b(a);$("#vocalun_album_information").empty().append(c)},this.reset=function(){$("#vocalun_album_information").empty()}},h=function(){function a(a){return-1!=a.indexOf("VOCALOID")||-1!=a.indexOf("音楽")}function h(){return $(".videoHeaderTagLink").map(function(a,b){return b.text}).get()}function i(a){return a.split("/").slice(-1)[0].split("?")[0].split("#")[0]}var j=new g(b.VocaDB);this.main=function(){j.init(),this.updateAlbumInformation();var a=new d($("#videoDetailInformation").get(0));a.onChanged(this.updateAlbumInformation)},this.updateAlbumInformation=function(){j.reset();var d=h();if(a(d)){var g=i(document.URL),k=new e(b.VocaDB,new f(localStorage));k.fetchAlbumInformation({id:g,success:function(a){a.albums&&j.render(a.albums)},error:function(a,b,d){c.log(d)}})}}},i=new h;i.main()},{"./cache.js":1,"./config":2,"./dom_observer":3,"./vocadb_fetcher":4,"./vocalun_console":6}],6:[function(a,b){var c=new function(){this.enable=!1,this.log=function(a){this.enable&&console.log(a)}};b.exports=c},{}]},{},[5]);